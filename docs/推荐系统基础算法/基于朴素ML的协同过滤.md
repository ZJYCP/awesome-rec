
# 基于朴素ML的协同过滤推荐算法

## 基于关联规则的推荐算法

---
> 背景：沃尔玛啤酒和尿布的故事

### 关联规则定义

假设$P={p_1,p_2,p_3,...,p_n}$是所有标的物的集合，定义关联规则$X\Rightarrow Y$,其中$X、Y$均是$P$的子集，且$X\cap Y=\empty$。表示$X$出现在用户的购物篮中，那么用户也有很大概率同时购买了$Y$。\
能发现关联规则的算法：Apriori

关联规则的度量指标：支持度(support)和置信度(confidence)
$$
支持度 = \frac{包含X\cup Y的交易数量}{总得交易数量}
$$
$$
置信度 = \frac{包含X\cup Y的交易数量}{包含X的交易数量}
$$



支持度越大，包含$X\cup Y$的交易越多，说明关联规则$X\Rightarrow Y$有更多的样本来支撑，置信度越大，更有把握从包含X的交易中推断出该交易包含Y。

### 推荐流程
推荐流程(用户u操作过的标的物集合为A)：

1. 挖掘出所有超过阈值的支持度和置信度的关联规则$X\Rightarrow Y$
2. 从挖掘出的所有关联规则中筛选出所有满足$X\subseteq A$的关联规则
3. 为用户生成推荐候选集，计算如下
$$
S = \cup_{X\subseteq A,X\Rightarrow Y}\{y|y\in Y,y\notin X\}
$$
候选集的排序可以按照置信度的大小，也可以用支持度和置信度的乘积

Spark MLlib中的两种分布式实现：FP-growth和PrefixSpan 

利用关联规则做推荐，是从用户过往行为中挖掘用户的行为模式，并用于推荐，由于只用到了用户的行为数据，因此也是协同过滤算法的一种。

### YouTube视频推荐算法

> Davidson J, Liebald B, Liu J, et al. The YouTube video recommendation system[C]//Proceedings of the fourth ACM conference on Recommender systems. 2010: 293-296.

YouTube基于关联规则思路的视频推荐算法基于假设：如果用户喜欢视频$v_i$，那么也会喜欢与视频$v_i$相似的候选视频$v_j$，且两者越相似，喜欢的概率就大。

#### 1.计算两个视频的相似度(关联度)

统计在一定时间内，用户同时播放过视频对$(v_i,v_j)$的次数$c_{ij}$,两个视频的相似度可以表示为
$$
r(v_i,v_j) = \frac{c_{ij}}{f(v_i,v_j)}
$$
其中$f(v_i,v_j)$是归一化常数，考虑视频$v_j,v_j$的全局流行度，可用在一定时间内的总播放次数来表示，即$f(v_i,v_j) = c_i \times c_j$。注意对所有的候选视频$v_j$来说，$c_i$是相同的，则归一化常数的大小取决于$c_j$, **其值越大，相似度可能会越小**，因此这种归一化方式更加偏向冷门的视频。

另外还可以整合metadata、观看时间等信息来计算相似度，同时要处理脏的播放行为

#### 2.基于单个种子视频生成候选视频集

选择最相似的TopN作为候选集，需要确定一个相似度阈值。

构建一个所有视频的有向图，对于视频对$(v_i,v_j)$，如果$v_j\in R_i$(R是候选视频集)，则存在一条从$v_i$到$v_j$的边，权重是这两个视频的相似度。

#### 3.基于用户行为为用户生成推荐候选集

把用户播放过或者明确表示过喜欢的视频作为初始种子视频集，在上述的有向图中沿着集合S的有向边向外扩展，对于种子视频$v_i$,它的相关视频集为$R_i$,记所有的相关视频集为$C_1$,则
$$
C_1(S) = \cup_{v_i\in S}R_i
$$

$C_1$的结果一般已经是比较多的，但其种类较为狭隘，和用户的兴趣过于相近，为了拓展推荐候选集的空间，可以将有向图的扩展进行n次（图论中称为n次闭包传递),得到
$$
C_n(S) = \cup_{v_i\in C_{n-1}}R_i
$$
$$
C_{final} = (\cup_{i=0}^{N}C_i)\backslash S
$$

n次扩展的操作同样也是具有一定可解释性的。

#### 4.推荐结果排序

考虑的维度：

  1. **视频质量**：海报清晰度、视频播放次数、点赞、转载等，将其记为Q。
  2. **偏好程度**：在有向图的扩展中，$s_i$是相似度，记用户u对视频$v_k$的偏好度为

    $$
    L_{u,v_k} = (\prod_{i=0}^k s_i ) \times R_0
    $$
    $R_0$是用户对种子视频的偏好度及它自身的受欢迎程度，可通过播放时长衡量。如果从$v_0$到$v_k$有多条路径，选择最短的，也是为了便于后续的计算。

最终的评分
$$
S_{u,v_k} = Q_{v_k} \times L_{u,v_k}
$$

从上述公式可以看出，离种子视频越远的视频，其得分越小。为了**多样性**的考虑，可以限制一个种子视频生成的候选集，因为这些候选集都是比较相似的。或者限制统一渠道产生的视频(如同一个用户上传的视频)，可以剔除部分此类视频。



> 相关文献 \
> Mining frequent patterns without candidate generation \
> Pfp:parallel fr-grouth for query recommendation \
> Mining sequential patterns by pattern-grouthL the PrefixSpan apprach \
> Robustness of collaborative recommendation based on association rule mining

## 基于朴素贝叶斯的推荐算法

---

TODO

## 基于聚类的推荐算法

---

### 基于用户聚类的推荐

对用户聚类，将该用户所在类别的其他用户操作过的标的物推荐给该用户。记推荐算法为Rec(u)是给用户u的推荐，$H$是用户所在的聚类，$A(u^\prime )$、$A(u)$分别是$u^\prime$和用户u的操作历史集合。
$$
Rec(u) = \cup_{u^\prime \in H}\{v\in A(u^\prime ) \& v \notin A(u) \}
$$
对用户进行聚类，有以下几种形式：

1. 基于用户的人口统计学特征

   用户的年龄、性别、地域、家庭组成、学历、收入等信息，转换成one-hot的形式，转化为数值，通过K-means进行聚类。

2. 基于用户的行为

可采用矩阵分解获得用户的嵌入表示，用户操作行为矩阵的行向量也是用户向量，形式多样。再利用K-means对用户聚类

3. 基于社交关系

根据用户之间的社交链条构成用户关系图，社交图中的所有联通区域构成了用户的聚类。实质是将好友喜欢的标的物推荐给你。

### 基于标的物聚类的推荐

$$
Rec(u) = \cup_{s\in H}\{t\in Cluster(s) \& t \neq s\}
$$

从用户历史行为中的标的物所在的类别挑选用户没有操作行为的标的物推荐给该用户。

对标的物的聚类方法，利用标的物的metadata，采用TF-IDF、LDA、word2vec等方式获得标的物的向量表示，在利用k-means进行聚类

### Google News基于用户聚类的推荐算法

1. 基于MinHash聚类



2. 基于聚类为用户做推荐
